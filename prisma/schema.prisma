generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model activites {
  id  Int    @id @default(autoincrement())
  nom String @unique @db.VarChar(50)
}

model assemblage {
  id          Int      @id @default(autoincrement())
  activity    String   @db.VarChar(255)
  quantite    Int?
  id_nozzle   String?  @db.VarChar(25)
  id_body     String?  @db.VarChar(25)
  date        DateTime @db.Date
  operateur   String   @db.VarChar(10)
  commentaire String?  @db.Text
}

model cote_piece {
  id            Int     @id @default(autoincrement())
  piece_id      Int?
  nom_cote      String? @db.VarChar(255)
  tolerance_min Int?
  tolerance_max Int?

  // üëá Relation inverse vers piece
  piece piece? @relation(fields: [piece_id], references: [id])

  @@index([piece_id], map: "piece_id")
}

model debuttomo_finis {
  id          String   @id @db.VarChar(50)
  nb_pieces   Int
  etage       Int
  date        DateTime @db.Date
  heure_debut DateTime @db.Time(0)
  operateur   String   @db.VarChar(50)
  num_machine String   @db.VarChar(50)
  version     String   @db.VarChar(25)
  separation  String   @db.VarChar(25)
  commentaire String?  @db.Text
}

model debut_etching {
  id            Int       @id @default(autoincrement())
  id_lot        Int
  num_lot_wafer String?   @db.VarChar(50)
  nb_pieces     Int?
  operateur     String?   @db.VarChar(50)
  nb_passage    Int?
  date_debut    String
  heure_debut   String
  temps_reel    Int?
  koh           String?   @db.VarChar(50)
  bain          String?   @db.VarChar(50)
  position      String?
  commentaire   String?   @db.Text
  created_at    DateTime? @default(now()) @db.Timestamp(0)
}

model debut_tomo {
  id_lot      Int    @id
  nb_pieces   Int
  etage       Int
  date        DateTime @db.Date
  heure_debut DateTime @db.Time(0)
  operateur   String   @db.VarChar(50)
  num_machine String   @db.VarChar(50)
  version     String   @db.VarChar(25)
  separation  String   @db.VarChar(25)
  commentaire String?  @db.Text
}

model denomination_options {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
}

model fintomo_finis {
  id        String   @id @db.VarChar(50)
  quantite  Int
  date      DateTime @db.Date
  heure     DateTime @db.Time(0)
  operateur String   @db.VarChar(50)
}

model fin_etching {
  id_lot            Int      @id @default(autoincrement())
  num_lot_wafer     String   @db.VarChar(50)
  nb_passage        Int
  date_fin          String
  heure_fin         String
  nb_piece_conforme Int
  operateur         String   @db.VarChar(100)
  commentaire       String?  @db.Text
}

model fin_impression {
  id_lot        Int       @id
  num_lot_wafer String?   @db.VarChar(50)
  nb_lancees    Int?
  nb_imprimees  Int?
  operateur     String?   @db.VarChar(100)
  date_fin      DateTime? @db.Date
  commentaires  String?   @db.Text
}

model fin_tomo {
  id_lot    Int   @id
  quantite  Int
  date      DateTime @db.Date
  heure     DateTime @db.Time(0)
  operateur String   @db.VarChar(50)
}

model imprimantes {
  id  Int    @id @default(autoincrement())
  nom String @unique @db.VarChar(100)
}

model lot_status {
  id_lot       Int       @id
  nb_pieces    Int?
  current_step String?   @db.VarChar(100)
  updated_at   DateTime? @default(now()) @updatedAt @db.DateTime(0)
  activity     String?   @db.VarChar(25)
  type_piece   String    @db.VarChar(100)
  revision     String    @db.VarChar(50)
}

model mesure_cote_piece {
  id              Int    @id @default(autoincrement())
  id_piece_locale String @db.VarChar(100)
  id_cote_piece   Int
  valeur          Int
  id_lot          Int
  nb_passage      Int

  @@index([id_cote_piece], map: "id_cote_piece")
  @@index([id_lot, nb_passage], map: "fk_mesure_prise")
}

model nc_pieces {
  id                 Int       @id @default(autoincrement())
  id_lot             String    @db.VarChar(50)
  id_piece           String    @db.VarChar(50)
  operateur          String?   @db.VarChar(100)
  date               DateTime? @db.Date
  denomination       String?   @db.VarChar(100)
  produit            String?   @db.VarChar(100)
  type_de_production String?   @db.VarChar(100)
  type               String?   @db.VarChar(50)
  description        String?   @db.Text
  decision           String?   @db.Text
  cause_racine       String?   @db.Text
  statut             String?   @default("Non trait√©") @db.VarChar(50)
  created_at         DateTime? @default(now()) @db.Timestamp(0)
  updated_at         DateTime? @default(now()) @updatedAt @db.Timestamp(0)
  justification      String?   @db.Text
  lien               String?   @db.Text
}

model nouvelle_impression {
  id              Int       @id @default(autoincrement())
  activity        String?   @db.VarChar(50)
  type_pieces     String?   @db.VarChar(50)
  version_piece   String?   @db.VarChar(10)
  num_lot_wafer   String?   @db.VarChar(255)
  nb_pieces       Int?
  imprimante      String?   @db.VarChar(50)
  date_impression DateTime? @db.Date
  operateur       String?   @db.VarChar(50)
  commentaire     String?   @db.Text
  created_at      DateTime? @default(now()) @db.Timestamp(0)
}

model piece {
  id       Int          @id @default(autoincrement())
  nom      String       @unique @db.VarChar(100)
  nb_cotes Int
  cotes    cote_piece[]
}

model prise_de_cotes {
  id_lot        Int
  nb_passage    Int
  type_piece    String?   @db.VarChar(100)
  nombre_pieces Int?
  date          DateTime? @db.Date

  @@id([id_lot, nb_passage])
}

model users {
  id          Int       @id @default(autoincrement())
  nom         String    @db.VarChar(100)
  prenom      String    @db.VarChar(100)
  email       String    @unique @db.VarChar(100)
  password    String    @db.VarChar(100)
  is_verified Boolean   @default(false)
  created_at  DateTime? @default(now()) @db.Timestamp(0)
}

model version_piece {
  version   String  @id @db.VarChar(50)
  nom_piece String? @db.VarChar(255)
}

model CalendarEvent {
  id        Int       @id @default(autoincrement())
  title     String
  startDate DateTime
  endDate   DateTime?
  color     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("calendarevent")
}

// update gestion pieces on ajoutant produit semi finis achet√©s et produit finis
model SemiFiniAchete {
  id        Int      @id @default(autoincrement())
  nom       String   @unique // conseill√© si tu utilises le nom comme "cl√©"
  quantite  Int      @default(0)
  createdAt DateTime @default(now())
  @@map("semifiniachete")
}

model ProduitFini {
  id         Int                    @id @default(autoincrement())
  nom        String
  references ProduitFiniReference[]
  createdAt  DateTime               @default(now())
  @@map("produitfini")
}

model ProduitFiniReference {
  id            Int @id @default(autoincrement())
  produitFiniId Int

  // 'semi-finis' | 'semi-finis-achetes'
  type String

  nom String

  quantite        Int
  tracerNumeroLot Boolean @default(false)

  produitFini ProduitFini @relation(fields: [produitFiniId], references: [id])

  @@index([produitFiniId])
}
